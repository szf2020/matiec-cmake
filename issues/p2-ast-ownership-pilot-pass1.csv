ID,Title,Description,Acceptance,Test_Method,Tools,Dev_Status,Review1_Status,Regression_Status,Files,Dependencies,Notes
E1,设计文档：AST 生命周期与所有权（P2 试点）,梳理当前 AST/lexer 字符串的生命周期机制（heap tracking + cstr_pool + ast_pin/ast_delete + reset 顺序），并给出“渐进式所有权/unique_ptr 化”的边界与后续拆解建议（本 issue 不改代码）。,新增 `docs/AST-OWNERSHIP.md`（中文）且内容覆盖：现状/约束/风险/推荐用法；不引入代码变更。,manual: review docs,manual,DONE,DONE,TODO,docs/AST-OWNERSHIP.md,none,none
E2,提取 compilation_cleanup_guard 并用于 C API,将 `src/matiec_lib.cc` 中的 `ast_roots_deleter`/`compilation_cleanup_guard` 提取到可复用的内部头文件（不改变 public C API）；`matiec_compile_file/string` 等路径改为包含并使用该 guard（行为不变）。,头文件新增且被 `src/matiec_lib.cc` 复用；Windows Release 构建与 ctest 通过。,"cmake --build build-vs --config Release | ctest --test-dir build-vs -C Release --output-on-failure",manual,TODO,TODO,TODO,"include/matiec/internal/compilation_guard.hpp | src/matiec_lib.cc",E1,none
E3,main.cc 采用 compilation_cleanup_guard（与库一致）,将 `main.cc` 的 per-compilation 清理逻辑改用 `compilation_cleanup_guard`（unique_ptr + ast_delete），移除重复的 scope_exit 清理代码（行为不变；仍保证 early return/异常路径释放）。,Windows Release 构建与 ctest 通过；清理逻辑等价且更一致。,"cmake --build build-vs --config Release | ctest --test-dir build-vs -C Release --output-on-failure",manual,TODO,TODO,TODO,main.cc,E2,none
E4,回归：P2 AST ownership pilot Pass1,完成 E1-E3 后执行回归：Windows Release 全量 ctest + WSL(ASan+LSan) 全量 ctest（detect_leaks=1），并确认 CI（含 linux-x64-sanitizers 的 LSan 门禁）通过。,Windows Release 全量 ctest 通过；WSL(ASan+LSan) 全量 ctest 通过；CI 绿。,"wsl: ASAN_OPTIONS=detect_leaks=1 ctest --test-dir build-wsl-asan --output-on-failure | ctest --test-dir build-vs -C Release --output-on-failure",manual,TODO,TODO,TODO,N/A,"E1|E2|E3",none
